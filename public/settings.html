<!--
add proxy switcher n panic key
-->

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title is="chemical-title" data-title-store>Malachite</title>
		<link rel="icon" is="chemical-icon" data-icon-store href="img/favicon.ico">
		<link rel="stylesheet" href="css/index.css">
		<link rel="stylesheet" href="css/transitions.css">
        <link rel="stylesheet" href="css/settings.css">
		        <script src="/chemical.js"></script>
		<script src="/chemical.components.js"></script>
        <script src="/chemical.cloaking.js"></script>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
        
        <script>
            // Tab switching functionality
            document.addEventListener('DOMContentLoaded', function() {
                const tabItems = document.querySelectorAll('.tab-item');
                const tabContents = document.querySelectorAll('.tab-content');
                
                tabItems.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const targetTab = this.getAttribute('data-tab');
                        
                        // Remove active class from all tabs and contents
                        tabItems.forEach(item => item.classList.remove('active'));
                        tabContents.forEach(content => {
                            content.classList.remove('active');
                            content.style.display = 'none';
                        });
                        
                        // Add active class to clicked tab and corresponding content
                        this.classList.add('active');
                        const targetContent = document.getElementById(targetTab);
                        targetContent.style.display = 'block';
                        targetContent.classList.add('active');
                    });
                });
            });
        </script>
	</head>
	<body>
		<div id="particles-js"></div>
		<div class="navbar">
			<div class="logo-container">
				<a href="index.html">
				<svg class="svg-logo" xmlns="http://www.w3.org/2000/svg" width="100" height="85" viewBox="0 0 300 255" preserveAspectRatio="xMidYMid meet">
					<g transform="translate(0,255) scale(0.1,-0.1)" fill="currentColor" stroke="none">
						<path d="M391 1923 c-200 -344 -365 -633 -367 -642 -2 -9 161 -299 364 -646 l367 -630 747 -3 746 -2 363 622 c199 343 366 630 372 638 6 11 -85 177 -361 650 l-370 635 -749 2 -748 2 -364 -626z m2008 -130 c162 -278 294 -511 294 -517 0 -6 -132 -240 -294 -518 l-294 -507 -601 -1 -600 0 -297 509 c-163 281 -297 513 -297 517 0 3 133 235 296 515 l297 509 601 0 601 0 294 -507z"/>
					</g>
				</svg>
				</a>
				<a href="index.html">Malachite</a>
			</div>
			<div class="nav-links">
				<a href="games.html">
					<i class="fa-solid fa-gamepad"></i> Games
				</a>
				<a href="apps.html">
					<i class="fa-solid fa-border-all"></i> Apps
				</a>
				<a href="settings.html">
					<i class="fa-solid fa-gear"></i> Settings
				</a>
			</div>
		</div>	
        <div class="settings-layout">
            <!-- Left Sidebar -->
            <div class="settings-sidebar">
                <div class="sidebar-tabs">
                    <div class="tab-item active" data-tab="proxy">
                        <i class="fa-solid fa-network-wired"></i>
                        <span>Proxy</span>
                    </div>
                    <div class="tab-item" data-tab="cloaking">
                        <i class="fa-solid fa-mask"></i>
                        <span>Cloaking</span>
                    </div>
                    <div class="tab-item" data-tab="security">
                        <i class="fa-solid fa-lock"></i>
                        <span>Security</span>
                    </div>
                    <div class="tab-item" data-tab="appearance">
                        <i class="fa-solid fa-palette"></i>
                        <span>Appearance</span>
                    </div>
                    <div class="tab-item" data-tab="misc">
                        <i class="fa-solid fa-cog"></i>
                        <span>Misc</span>
                    </div>
                    <div class="tab-item" data-tab="credits">
                        <i class="fa-solid fa-star"></i>
                        <span>Credits</span>
                    </div>
                </div>
                <div class="sidebar-footer">
                    <button class="sidebar-logout-btn" onclick="signOut()">
                        <i class="fa-solid fa-sign-out-alt"></i>
                        <span>Log Out</span>
                    </button>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="settings-content">
                <!-- Proxy Settings Tab -->
                <div class="tab-content active" id="proxy">
                    <div class="settings-container">
                        <div class="setting-card">
                            <div class="setting-title">Select Transport</div>
                            <div class="setting-description">Select the transport you want the proxy to use.</div>
                            <select id="transport-select">
                                <option value="libcurl">Libcurl (Default)</option>
                                <option value="epoxy">Epoxy</option>
                            </select>
                        </div>

                        <div class="setting-card">
                            <div class="setting-title">Proxy Backend</div>
                            <div class="setting-description">Choose which proxy backend to use.</div>
                            <select id="proxy-backend-select">
                                <option value="uv">Ultraviolet (Default)</option>
                                <option value="rh">Rammerhead</option>
                            </select>
                        </div>

                        <div class="setting-card">
                            <div class="setting-title">Select Search Engine</div>
                            <div class="setting-description">Choose which search engine to use.</div>
                            <select id="searchengine-select">
                                <option value="duckduckgo">DuckDuckGo (Default)</option>
                                <option value="google">Google</option>
                                <option value="bing">Bing</option>
                                <option value="brave">Brave Search</option>
                                <option value="startpage">Startpage</option>
                                <option value="ecosia">Ecosia</option>
                                <option value="yahoo">Yahoo</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Cloaking Tab -->
                <div class="tab-content" id="cloaking">
                    <div class="settings-container">
                        <div class="setting-card">
                            <div class="setting-title">About:Blank Cloak</div>
                            <div class="setting-description">Simple about:blank cloak to hide the site from your search history.</div>
                            <button class="setting-button" onclick="launchab()">Launch in About:Blank</button>
                        </div>
                        <div class="setting-card">
                            <div class="setting-title">Automatic About:Blank Cloak</div>
                            <div class="setting-description">Automatically cloaks the page in About:Blank if its not already.</div>
                            <button class="setting-button" id="autoabbutton" onclick="autoab()">Automatically launch in About:Blank</button>
                        </div>
                        <div class="setting-card">
                            <div class="setting-title">Tab Cloaking</div>
                            <div class="setting-description">Disguise the tab with some of the presets.</div>
                            <select id="cloak-select">
                                <option value="Default">Default</option>
                                <option value="Google">Google</option>
                                <option value="Gmail">Gmail</option>
                                <option value="Google Drive">Google Drive</option>
                                <option value="Schoology">Schoology</option>
                                <option value="iReady">iReady</option>
                                <option value="Clever">Clever</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Security Tab -->
                <div class="tab-content" id="security">
                    <div class="settings-container">
                        <div class="setting-card">
                            <div class="setting-title">Leave Confirmation</div> 
                            <div class="setting-description">Shows a popup when you or another software attempt to close the page.</div> 
                            <button class="setting-button" id="leaveconfirmbutton" onclick="leaveconfirmation()">Toggle Leave Confirmation</button>  
                        </div>
                        <div class="setting-card">
                            <div class="setting-title">Panic Key</div>
                            <div class="setting-description">Choose a key that redirects you to a website when pressed.</div>
                            <button class="setting-button" onclick="openKeybindModal()">Open Panic Key Settings</button>
                        </div>
                    </div>
                </div>

                <!-- Appearance Tab -->
                <div class="tab-content" id="appearance">
                    <div class="settings-container">
                        <div class="setting-card">
                            <div class="setting-title">Theme</div>
                            <div class="setting-description">Choose your preferred site theme.</div>
                            <select id="theme-select">
                                <option value="moss">Moss (Default)</option>
                                <option value="midnight">Midnight</option>
                                <option value="rose">Rose</option>
                                <option value="noir">Noir</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Misc Tab -->
                <div class="tab-content" id="misc">
                    <div class="settings-container">
                        <div class="setting-card">
                            <div class="setting-title">Change Credentials</div>
                            <div class="setting-description">Change your login credentials.</div>
                            <button class="setting-button" onclick="openCredentialsModal()">Change Credentials</button>
                        </div>
                        <div class="setting-card">
                            <div class="setting-title">Change Display Name</div>
                            <div class="setting-description">Change the name displayed in your greeting.</div>
                            <button class="setting-button" onclick="openChangeNameModal()">Change Display Name</button>
                        </div>
                    </div>
                </div>

                        <!-- Credits Tab -->
        <div class="tab-content" id="credits">
            <div class="settings-container">
                <div class="setting-card">
                    <div class="setting-title">About Malachite</div>
                    <div class="setting-title" style="font-weight: normal; font-size: medium;">Malachite is a web proxy designed with simplicity and elegance in mind.</div>
                    <div class="setting-title" style="font-weight: normal; font-size: medium;">Current Version: 1.1.0</div>
                    <div class="setting-title" style="font-weight: normal; font-size: medium;">This project is licensed under the AGPL-3.0 License.</div>
                </div>
                <div class="setting-card">
                    <div class="setting-title">Developers</div>
                    <div class="setting-description">Currently Malachite is a solo project started by cactusflips2020.</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; justify-content: center;">
                        <a href="https://github.com/cactusflips2020" target="_blank" class="tool-card">
                            <div class="tool-logo">
                                <img src="img/assets/cactusflips2020.jpg" alt="cactusflips2020" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <span style="display: none;">👨‍💻</span>
                            </div>
                            <div class="tool-name">cactusflips2020</div>
                        </a>
                    </div>
                </div>
                <div class="setting-card">
                    <div class="setting-title">Tools and Projects</div>
                    <div class="setting-description">Without these Malachite wouldn't of been possible to make.</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; justify-content: center;">
                        <a href="https://github.com/titaniumnetwork-dev/ultraviolet" target="_blank" class="tool-card">
                            <div class="tool-logo">
                                <img src="img/assets/ultraviolet.webp" alt="Ultraviolet" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <span style="display: none;">🔮</span>
                            </div>
                            <div class="tool-name">Ultraviolet</div>
                        </a>
                        <a href="https://github.com/binary-person/rammerhead" target="_blank" class="tool-card">
                            <div class="tool-logo">
                                <img src="img/assets/rammerhead.png" alt="Rammerhead" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <span style="display: none;">🚀</span>
                            </div>
                            <div class="tool-name">Rammerhead</div>
                        </a>
                        <a href="https://github.com/chemicaljs/chemical" target="_blank" class="tool-card">
                            <div class="tool-logo">
                                <img src="img/assets/chemical.png" alt="ChemicalJS" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <span style="display: none;">🧪</span>
                            </div>
                            <div class="tool-name">ChemicalJS</div>
                        </a>
                        <a href="https://github.com/mercuryworkshop/epoxy-tls" target="_blank" class="tool-card">
                            <div class="tool-logo">
                                <img src="img/assets/epoxy.webp" alt="Epoxy TLS" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <span style="display: none;">🔗</span>
                            </div>
                            <div class="tool-name">Epoxy TLS</div>
                        </a>
                        <a href="https://github.com/ading2210/libcurl.js" target="_blank" class="tool-card">
                            <div class="tool-logo">
                                <img src="img/assets/libcurl.webp" alt="libcurl.js" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <span style="display: none;">🌐</span>
                            </div>
                            <div class="tool-name">Libcurl.js</div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
            </div>
        </div>
        <div id="keybind-modal" class="keybind-modal" style="display:none;">
            <div id="keybind-particles-js"></div>
            <div class="keybind-content">
                <div class="keybind-title">Select Panic Key</div>
                <div class="keybind-description">Click the box and press a key. Press Escape to unbind.</div>
                <br>
                
                <div id="keybind-display" class="keybind-box">No key bound</div>
        
                <div class="keybind-description" style="margin-top: 10px;">Custom Panic URL</div>
                <input id="keybind-url" class="keybind-url" placeholder="https://www.google.com" />
        
                <div class="keybind-buttons">
                    <button id="applykeybindbutton" onclick="applyKeybind()">Apply</button>
                    <button id="resetkeybindbutton" onclick="resetKeybind()">Reset</button>
                    <button onclick="closeKeybindModal()">Cancel</button>
                </div>
            </div>
        </div>   
        <div class="credentials-modal" id="credentials-modal">
            <div id="credentials-particles-js"></div>
            <div class="credentials-modal-content">
              <h2>Change Credentials</h2>
              <input type="text" id="new-username" placeholder="Username" />
              <input type="password" id="new-password" placeholder="Password" />
              <div class="credentials-buttons">
                <button id="applycredentialsbutton" onclick="applyCredentials()">Apply</button>
                <button id="resetcredentialsbutton" onclick="resetCredentials()">Reset</button>
                <button onclick="closeCredentialsModal()">Close</button>
              </div>
            </div>
          </div>
        <div class="change-name-modal" id="change-name-modal">
            <div id="change-name-particles-js"></div>
            <div class="change-name-modal-content">
              <h2>Change Display Name</h2>
              <p>Enter your new display name (max 20 characters):</p>
              <input type="text" id="change-name-input" placeholder="Enter your new name" maxlength="20" />
              <div class="change-name-buttons">
                <button id="applychangenamebutton" onclick="applyChangeName()">Apply</button>
                <button onclick="closeChangeNameModal()">Cancel</button>
              </div>
            </div>
          </div>
        <div id="change-name-notification" class="change-name-notification">
            <span>Changes saved!</span>
        </div>
        
        <!-- Welcome Back Overlay -->
        <div id="welcomeBackOverlay" class="welcome-back-overlay">
            <div class="welcome-back-content">
                <div class="welcome-back-icon">
                    <i class="fa-solid fa-hand-wave"></i>
                </div>
                <div class="welcome-back-title" id="welcomeBackTitle">Welcome Back!</div>
                <div class="welcome-back-message" id="welcomeBackMessage">Great to see you again!</div>
            </div>
        </div>
        
        <!--add a notification when changes are made-->   
        </div>
        <script src="js/particles.min.js"></script>
        <script>
            // Theme-based particle configurations
            const particleConfigs = {
                moss: {
                    particles: {
                        number: { value: 40, density: { enable: true, value_area: 800 } },
                        color: { value: ['#b2c2a8', '#94e2d5', '#a6e3a1', '#89dceb'] },
                        shape: { type: 'circle' },
                        opacity: { value: 0.3, random: true, anim: { enable: false, speed: 1, opacity_min: 0.1, sync: false } },
                        size: { value: 2, random: true, anim: { enable: false, speed: 2, size_min: 1, sync: false } },
                        line_linked: { enable: true, distance: 200, color: '#b2c2a8', opacity: 0.2, width: 0.5 },
                        move: { enable: true, speed: 1.5, direction: 'none', random: true, straight: false, out_mode: 'bounce', bounce: true, attract: { enable: false, rotateX: 600, rotateY: 1200 } }
                    },
                    interactivity: {
                        detect_on: 'canvas',
                        events: {
                            onhover: { enable: false, mode: 'repulse' },
                            onclick: { enable: false, mode: 'push' },
                            resize: true
                        },
                        modes: {
                            grab: { distance: 140, line_linked: { opacity: 1 } },
                            bubble: { distance: 400, size: 40, duration: 2, opacity: 8, speed: 3 },
                            repulse: { distance: 150, duration: 0.4 },
                            push: { particles_nb: 4 },
                            remove: { particles_nb: 2 }
                        }
                    },
                    retina_detect: true
                },
                midnight: {
                    particles: {
                        number: { value: 50, density: { enable: true, value_area: 800 } },
                        color: { value: ['#b8c7e0', '#81a1c1', '#5e81ac', '#88c0d0'] },
                        shape: { type: 'circle' },
                        opacity: { value: 0.4, random: true, anim: { enable: false, speed: 1.5, opacity_min: 0.2, sync: false } },
                        size: { value: 2.5, random: true, anim: { enable: false, speed: 4, size_min: 1, sync: false } },
                        line_linked: { enable: true, distance: 180, color: '#b8c7e0', opacity: 0.25, width: 0.5 },
                        move: { enable: true, speed: 2, direction: 'none', random: true, straight: false, out_mode: 'bounce', bounce: true, attract: { enable: false, rotateX: 600, rotateY: 1200 } }
                    },
                    interactivity: {
                        detect_on: 'canvas',
                        events: {
                            onhover: { enable: false, mode: 'grab' },
                            onclick: { enable: false, mode: 'push' },
                            resize: true
                        },
                        modes: {
                            grab: { distance: 140, line_linked: { opacity: 1 } },
                            bubble: { distance: 400, size: 40, duration: 2, opacity: 8, speed: 3 },
                            repulse: { distance: 200, duration: 0.4 },
                            push: { particles_nb: 4 },
                            remove: { particles_nb: 2 }
                        }
                    },
                    retina_detect: true
                },
                rose: {
                    particles: {
                        number: { value: 35, density: { enable: true, value_area: 800 } },
                        color: { value: ['#e0b8c7', '#f38ba8', '#eba0ac', '#f5c2e7'] },
                        shape: { type: 'circle' },
                        opacity: { value: 0.35, random: true, anim: { enable: false, speed: 1.2, opacity_min: 0.2, sync: false } },
                        size: { value: 2.2, random: true, anim: { enable: false, speed: 2.5, size_min: 1, sync: false } },
                        line_linked: { enable: true, distance: 220, color: '#e0b8c7', opacity: 0.2, width: 0.5 },
                        move: { enable: true, speed: 1.8, direction: 'none', random: true, straight: false, out_mode: 'bounce', bounce: true, attract: { enable: false, rotateX: 600, rotateY: 1200 } }
                    },
                    interactivity: {
                        detect_on: 'canvas',
                        events: {
                            onhover: { enable: false, mode: 'bubble' },
                            onclick: { enable: false, mode: 'push' },
                            resize: true
                        },
                        modes: {
                            grab: { distance: 140, line_linked: { opacity: 1 } },
                            bubble: { distance: 200, size: 40, duration: 2, opacity: 8, speed: 3 },
                            repulse: { distance: 200, duration: 0.4 },
                            push: { particles_nb: 4 },
                            remove: { particles_nb: 2 }
                        }
                    },
                    retina_detect: true
                },
                noir: {
                    particles: {
                        number: { value: 30, density: { enable: true, value_area: 800 } },
                        color: { value: ['#e0e0e0', '#c0c0c0', '#a0a0a0', '#808080'] },
                        shape: { type: 'circle' },
                        opacity: { value: 0.25, random: true, anim: { enable: false, speed: 1, opacity_min: 0.1, sync: false } },
                        size: { value: 1.8, random: true, anim: { enable: false, speed: 3, size_min: 1, sync: false } },
                        line_linked: { enable: true, distance: 250, color: '#e0e0e0', opacity: 0.15, width: 0.5 },
                        move: { enable: true, speed: 1.2, direction: 'none', random: true, straight: false, out_mode: 'bounce', bounce: true, attract: { enable: false, rotateX: 600, rotateY: 1200 } }
                    },
                    interactivity: {
                        detect_on: 'canvas',
                        events: {
                            onhover: { enable: false, mode: 'repulse' },
                            onclick: { enable: false, mode: 'push' },
                            resize: true
                        },
                        modes: {
                            grab: { distance: 140, line_linked: { opacity: 1 } },
                            bubble: { distance: 400, size: 40, duration: 2, opacity: 8, speed: 3 },
                            repulse: { distance: 180, duration: 0.4 },
                            push: { particles_nb: 4 },
                            remove: { particles_nb: 2 }
                        }
                    },
                    retina_detect: true
                }
            };

            // Function to initialize particles with current theme
            function initializeParticles() {
                const currentTheme = localStorage.getItem('siteTheme') || 'moss';
                const config = particleConfigs[currentTheme];
                
                console.log('Initializing particles for theme:', currentTheme);
                if (typeof particlesJS !== 'undefined' && config) {
                    particlesJS('particles-js', config);
                    console.log('Particles initialized successfully for theme:', currentTheme);
                } else {
                    console.log('ParticlesJS not available or config not found');
                }
            }

            // Initialize particles on page load
            window.addEventListener('load', initializeParticles);

            // Reinitialize particles when theme changes
            window.addEventListener('storage', function(e) {
                if (e.key === 'siteTheme') {
                    // Clean up existing particles
                    if (typeof pJSDom !== 'undefined' && pJSDom.length > 0) {
                        pJSDom[0].pJS.fn.vendors.destroypJS();
                        pJSDom = [];
                    }
                    // Reinitialize with new theme
                    setTimeout(initializeParticles, 100);
                }
            });
            
            // Welcome back overlay functionality
            function checkWelcomeBack() {
                const lastVisit = localStorage.getItem('lastVisit');
                const currentTime = Date.now();
                const userName = localStorage.getItem('userName');
                
                // Show welcome back if:
                // 1. User has a name set
                // 2. Last visit was more than 30 seconds ago (to avoid showing on refresh)
                // 3. Last visit exists (not first time)
                // 4. User actually left the site (not just navigated between pages)
                if (userName && lastVisit && (currentTime - parseInt(lastVisit)) > 30000) {
                    showWelcomeBackOverlay();
                }
                
                // Don't update last visit time here - only update when actually leaving the site
            }
            
            // Track when user leaves the site
            function trackSiteLeave() {
                localStorage.setItem('lastVisit', Date.now().toString());
            }
            
            // Listen for when user leaves the site
            window.addEventListener('beforeunload', trackSiteLeave);
            window.addEventListener('pagehide', trackSiteLeave);
            
            // Function to show welcome back overlay
            function showWelcomeBackOverlay() {
                const overlay = document.getElementById('welcomeBackOverlay');
                const title = document.getElementById('welcomeBackTitle');
                const message = document.getElementById('welcomeBackMessage');
                const userName = localStorage.getItem('userName');
                
                // Update the welcome message with user's name
                title.textContent = `Welcome Back, ${userName}!`;
                message.textContent = 'Great to see you again!';
                
                // Show the overlay
                overlay.classList.add('show');
                
                // Hide after 3 seconds
                setTimeout(() => {
                    overlay.classList.remove('show');
                }, 3000);
            }
            
            // Check welcome back when page loads
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(checkWelcomeBack, 100);
            });
        </script>
        		<script src="js/settings.js" defer></script>
		<script src="js/main.js" defer></script>
		<script src="js/transitions.js" defer></script>	
	</body>
</html>
