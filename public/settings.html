<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title is="chemical-title" data-title-store>Malachite</title>
		<link rel="icon" is="chemical-icon" data-icon-store href="img/favicon.svg">
		<link rel="stylesheet" href="css/index.css">
		<link rel="stylesheet" href="css/transitions.css">
        <link rel="stylesheet" href="css/settings.css">
        <link rel="stylesheet" href="css/modals.css">
		        <script src="/chemical.js"></script>
		<script src="/chemical.components.js"></script>
        <script src="/chemical.cloaking.js"></script>
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
        
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const tabItems = document.querySelectorAll('.tab-item');
                const tabContents = document.querySelectorAll('.tab-content');
                
                tabItems.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const targetTab = this.getAttribute('data-tab');
                        
                        tabItems.forEach(item => item.classList.remove('active'));
                        tabContents.forEach(content => {
                            content.classList.remove('active');
                            content.style.display = 'none';
                        });
                        
                        this.classList.add('active');
                        const targetContent = document.getElementById(targetTab);
                        targetContent.style.display = 'block';
                        targetContent.classList.add('active');
                    });
                });
            });
        </script>
	</head>
	<body>
		<div id="particles-js"></div>
		<div class="navbar">
			<div class="logo-container">
				<a href="index.html">
				<svg class="svg-logo" xmlns="http://www.w3.org/2000/svg" width="100" height="85" viewBox="0 0 300 255" preserveAspectRatio="xMidYMid meet">
					<g transform="translate(0,255) scale(0.1,-0.1)" fill="currentColor" stroke="none">
						<path d="M391 1923 c-200 -344 -365 -633 -367 -642 -2 -9 161 -299 364 -646 l367 -630 747 -3 746 -2 363 622 c199 343 366 630 372 638 6 11 -85 177 -361 650 l-370 635 -749 2 -748 2 -364 -626z m2008 -130 c162 -278 294 -511 294 -517 0 -6 -132 -240 -294 -518 l-294 -507 -601 -1 -600 0 -297 509 c-163 281 -297 513 -297 517 0 3 133 235 296 515 l297 509 601 0 601 0 294 -507z"/>
					</g>
				</svg>
				</a>
				<a href="index.html">Malachite</a>
			</div>
			<div class="nav-links">
				<a href="games.html">
					<i class="fa-solid fa-gamepad"></i> Games
				</a>
				<a href="apps.html">
					<i class="fa-solid fa-border-all"></i> Apps
				</a>
				<a href="settings.html">
					<i class="fa-solid fa-gear"></i> Settings
				</a>
			</div>
		</div>	
        <div class="settings-layout">   
            <div class="settings-sidebar">
                <div class="sidebar-tabs">
                    <div class="tab-item active" data-tab="proxy">
                        <i class="fa-solid fa-network-wired"></i>
                        <span>Proxy</span>
                    </div>
                    <div class="tab-item" data-tab="cloaking">
                        <i class="fa-solid fa-mask"></i>
                        <span>Cloaking</span>
                    </div>
                    <div class="tab-item" data-tab="security">
                        <i class="fa-solid fa-lock"></i>
                        <span>Security</span>
                    </div>
                    <div class="tab-item" data-tab="appearance">
                        <i class="fa-solid fa-palette"></i>
                        <span>Appearance</span>
                    </div>
                    <div class="tab-item" data-tab="misc">
                        <i class="fa-solid fa-cog"></i>
                        <span>Misc</span>
                    </div>
                    <div class="tab-item" data-tab="credits">
                        <i class="fa-solid fa-star"></i>
                        <span>Credits</span>
                    </div>
                </div>
                <div class="sidebar-footer">
                    <button class="sidebar-logout-btn" onclick="signOut()">
                        <i class="fa-solid fa-sign-out-alt"></i>
                        <span>Log Out</span>
                    </button>
                </div>
            </div>

            <div class="settings-content">
                <div class="tab-content active" id="proxy">
                    <div class="settings-container">
                        <div class="setting-card">
                            <div class="setting-title">Select Transport</div>
                            <div class="setting-description">Select the transport you want the proxy to use.</div>
                            <select id="transport-select">
                                <option value="libcurl">Libcurl (Default)</option>
                                <option value="epoxy">Epoxy</option>
                            </select>
                        </div>

                        <div class="setting-card">
                            <div class="setting-title">Proxy Backend</div>
                            <div class="setting-description">Choose which proxy backend to use.</div>
                            <select id="proxy-backend-select">
                                <option value="uv">Ultraviolet (Default)</option>
                                <option value="rh">Rammerhead</option>
                            </select>
                        </div>

                        <div class="setting-card">
                            <div class="setting-title">Select Search Engine</div>
                            <div class="setting-description">Choose which search engine to use.</div>
                            <select id="searchengine-select">
                                <option value="duckduckgo">DuckDuckGo (Default)</option>
                                <option value="google">Google</option>
                                <option value="bing">Bing</option>
                                <option value="brave">Brave Search</option>
                                <option value="startpage">Startpage</option>
                                <option value="ecosia">Ecosia</option>
                                <option value="yahoo">Yahoo</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="cloaking">
                    <div class="settings-container">
                        <div class="setting-card">
                            <div class="setting-title">About:Blank Cloak</div>
                            <div class="setting-description">Simple about:blank cloak to hide the site from your search history.</div>
                            <button class="setting-button" onclick="launchab()">Launch in About:Blank</button>
                        </div>
                        <div class="setting-card">
                            <div class="setting-title">Automatic About:Blank Cloak</div>
                            <div class="setting-description">Automatically cloaks the page in About:Blank if its not already.</div>
                            <button class="setting-button" id="autoabbutton" onclick="autoab()">Automatically launch in About:Blank</button>
                        </div>
                        <div class="setting-card">
                            <div class="setting-title">Tab Cloaking</div>
                            <div class="setting-description">Disguise the tab with some of the presets.</div>
                            <select id="cloak-select">
                                <option value="Default">Default</option>
                                <option value="Google">Google</option>
                                <option value="Gmail">Gmail</option>
                                <option value="Google Drive">Google Drive</option>
                                <option value="Schoology">Schoology</option>
                                <option value="iReady">iReady</option>
                                <option value="Clever">Clever</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="security">
                    <div class="settings-container">
                        <div class="setting-card">
                            <div class="setting-title">Leave Confirmation</div> 
                            <div class="setting-description">Shows a popup when you or another software attempt to close the page.</div> 
                            <button class="setting-button" id="leaveconfirmbutton" onclick="leaveconfirmation()">Toggle Leave Confirmation</button>  
                        </div>
                        <div class="setting-card">
                            <div class="setting-title">Panic Key</div>
                            <div class="setting-description">Choose a key that redirects you to a website when pressed.</div>
                            <button class="setting-button" onclick="openKeybindModal()">Open Panic Key Settings</button>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="appearance">
                    <div class="settings-container">
                        <div class="setting-card">
                            <div class="setting-title">Theme</div>
                            <div class="setting-description">Choose your preferred site theme.</div>
                            <select id="theme-select">
                                <option value="moss">Moss (Default)</option>
                                <option value="midnight">Midnight</option>
                                <option value="rose">Rose</option>
                                <option value="noir">Noir</option>
                                <option value="ocean">Ocean</option>
                                <option value="sunset">Sunset</option>
                                <option value="solar">Solar</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="misc">
                    <div class="settings-container">
                        <div class="setting-card">
                            <div class="setting-title">Change Credentials</div>
                            <div class="setting-description">Change your login credentials.</div>
                            <button class="setting-button" onclick="openCredentialsModal()">Change Credentials</button>
                        </div>
                        <div class="setting-card">
                            <div class="setting-title">Change Display Name</div>
                            <div class="setting-description">Change the name displayed in your greeting.</div>
                            <button class="setting-button" onclick="openChangeNameModal()">Change Display Name</button>
                        </div>
                        <div class="setting-card">
                            <div class="setting-title">Export Settings</div>
                            <div class="setting-description">Export all your settings as base64 and copy to clipboard.</div>
                            <button class="setting-button" onclick="exportSettings()">Export Settings</button>
                        </div>
                        <div class="setting-card">
                            <div class="setting-title">Import Settings</div>
                            <div class="setting-description">Import settings from clipboard (base64 format).</div>
                            <button class="setting-button" onclick="importSettings()">Import Settings</button>
                        </div>
                        <div class="setting-card">
                            <div class="setting-title">Reset Instance</div>
                            <div class="setting-description">Reset all settings to default.</div>
                            <button class="setting-button reset-btn" onclick="resetInstance()">Reset Instance</button>
                        </div>
                    </div>
                </div>

        <div class="tab-content" id="credits">
            <div class="settings-container">
                <div class="setting-card">
                    <div class="setting-title">About Malachite</div>
                    <div class="setting-title" style="font-weight: normal; font-size: medium;">Malachite is a web proxy designed with simplicity and elegance in mind.</div>
                    <div class="setting-title" style="font-weight: normal; font-size: medium;">Current Version: 1.1.0</div>
                    <div class="setting-title" style="font-weight: normal; font-size: medium;">This project is licensed under the AGPL-3.0 License.</div>
                </div>
                <div class="setting-card">
                    <div class="setting-title">Developers</div>
                    <div class="setting-description">Currently Malachite is a solo project started by cactusflips2020.</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; justify-content: center;">
                        <a href="https://github.com/cactusflips2020" target="_blank" class="tool-card">
                            <div class="tool-logo">
                                <img src="img/assets/cactusflips2020.jpg" alt="cactusflips2020" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <span style="display: none;">üë®‚Äçüíª</span>
                            </div>
                            <div class="tool-name">cactusflips2020</div>
                        </a>
                    </div>
                </div>
                <div class="setting-card">
                    <div class="setting-title">Tools and Projects</div>
                    <div class="setting-description">Without these Malachite wouldn't of been possible to make.</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; justify-content: center;">
                        <a href="https://github.com/titaniumnetwork-dev/ultraviolet" target="_blank" class="tool-card">
                            <div class="tool-logo">
                                <img src="img/assets/ultraviolet.webp" alt="Ultraviolet" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <span style="display: none;">üîÆ</span>
                            </div>
                            <div class="tool-name">Ultraviolet</div>
                        </a>
                        <a href="https://github.com/binary-person/rammerhead" target="_blank" class="tool-card">
                            <div class="tool-logo">
                                <img src="img/assets/rammerhead.png" alt="Rammerhead" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <span style="display: none;">üöÄ</span>
                            </div>
                            <div class="tool-name">Rammerhead</div>
                        </a>
                        <a href="https://github.com/chemicaljs/chemical" target="_blank" class="tool-card">
                            <div class="tool-logo">
                                <img src="img/assets/chemical.png" alt="ChemicalJS" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <span style="display: none;">üß™</span>
                            </div>
                            <div class="tool-name">ChemicalJS</div>
                        </a>
                        <a href="https://github.com/mercuryworkshop/epoxy-tls" target="_blank" class="tool-card">
                            <div class="tool-logo">
                                <img src="img/assets/epoxy.webp" alt="Epoxy TLS" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <span style="display: none;">üîó</span>
                            </div>
                            <div class="tool-name">Epoxy TLS</div>
                        </a>
                        <a href="https://github.com/ading2210/libcurl.js" target="_blank" class="tool-card">
                            <div class="tool-logo">
                                <img src="img/assets/libcurl.webp" alt="libcurl.js" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                <span style="display: none;">üåê</span>
                            </div>
                            <div class="tool-name">Libcurl.js</div>
                        </a>
                    </div>
                </div>
            </div>
        </div>
            </div>
        </div>
        <div id="keybind-modal" class="keybind-modal">
            <div id="keybind-particles-js"></div>
            <div class="keybind-content">
                <div class="add-modal-header">
                    <h2>Select Panic Key</h2>
                    <button class="close-modal" onclick="closeKeybindModal()">&times;</button>
                </div>
                <div class="add-modal-body">
                    <div class="form-group">
                        <label>Click the box and press a key. Press Escape to unbind.</label>
                        <div id="keybind-display" class="keybind-box">No key bound</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="keybind-url">Custom Panic URL</label>
                        <input id="keybind-url" class="keybind-url" placeholder="https://www.google.com" />
                    </div>
                    
                    <div class="form-actions">
                        <button id="applykeybindbutton" onclick="applyKeybind()" class="add-btn">Apply</button>
                        <button id="resetkeybindbutton" onclick="resetKeybind()" class="reset-btn">Reset</button>
                        <button onclick="closeKeybindModal()" class="cancel-btn">Cancel</button>
                    </div>
                </div>
            </div>
        </div>   
        <div class="credentials-modal" id="credentials-modal">
            <div id="credentials-particles-js"></div>
            <div class="credentials-modal-content">
                <div class="add-modal-header">
                    <h2>Change Credentials</h2>
                    <button class="close-modal" onclick="closeCredentialsModal()">&times;</button>
                </div>
                <div class="add-modal-body">
                    <div class="form-group">
                        <label for="new-username">Username</label>
                        <input type="text" id="new-username" placeholder="Username" />
                    </div>
                    <div class="form-group">
                        <label for="new-password">Password</label>
                        <input type="password" id="new-password" placeholder="Password" />
                    </div>
                    <div class="form-actions">
                        <button id="applycredentialsbutton" onclick="applyCredentials()" class="add-btn">Apply</button>
                        <button id="resetcredentialsbutton" onclick="resetCredentials()" class="reset-btn">Reset</button>
                        <button onclick="closeCredentialsModal()" class="cancel-btn">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="change-name-modal" id="change-name-modal">
            <div class="change-name-modal-content">
                <div class="add-modal-header">
                    <h2>Change Display Name</h2>
                    <button class="close-modal" onclick="closeChangeNameModal()">&times;</button>
                </div>
                <div class="add-modal-body">
                    <div class="form-group">
                        <label for="change-name-input">Enter your new display name (max 20 characters):</label>
                        <input type="text" id="change-name-input" placeholder="Enter your new name" maxlength="20" />
                    </div>
                    <div class="form-actions">
                        <button id="applychangenamebutton" onclick="applyChangeName()" class="add-btn">Apply</button>
                        <button onclick="closeChangeNameModal()" class="cancel-btn">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="change-name-notification" class="change-name-notification">
            <span>Changes saved!</span>
        </div>
        
        <div id="welcomeBackOverlay" class="welcome-back-overlay">
            <div class="welcome-back-content">
                <div class="welcome-back-icon">
                    <i class="fa-solid fa-hand-wave"></i>
                </div>
                <div class="welcome-back-title" id="welcomeBackTitle">Welcome Back!</div>
                <div class="welcome-back-message" id="welcomeBackMessage">Great to see you again!</div>
            </div>
        </div>
                
        </div>
        <script src="js/particles.min.js"></script>
        <script src="js/particle-configs.js"></script>
        <script>
            // Ensure all modals are hidden by default
            document.addEventListener('DOMContentLoaded', function() {
                const modals = document.querySelectorAll('.keybind-modal, .credentials-modal, .change-name-modal');
                modals.forEach(modal => {
                    modal.classList.remove('show');
                });
                
                // Add click outside to close functionality
                modals.forEach(modal => {
                    modal.addEventListener('click', function(e) {
                        if (e.target === modal) {
                            modal.classList.remove('show');
                        }
                    });
                });
            });
            function initializeParticles() {
                const config = getParticleConfig();
                if (typeof particlesJS !== 'undefined' && config) {
                    particlesJS('particles-js', config);
                }
            }

            window.addEventListener('load', initializeParticles);

            window.addEventListener('storage', function(e) {
                if (e.key === 'siteTheme') {
                    if (typeof pJSDom !== 'undefined' && pJSDom.length > 0) {
                        pJSDom[0].pJS.fn.vendors.destroypJS();
                        pJSDom = [];
                    }   
                    setTimeout(initializeParticles, 100);
                }
            });
            
            function checkWelcomeBack() {
                const lastVisit = localStorage.getItem('lastVisit');
                const currentTime = Date.now();
                const userName = localStorage.getItem('userName');
                
                if (userName && lastVisit && (currentTime - parseInt(lastVisit)) > 30000) {
                    showWelcomeBackOverlay();
                }
                
            }
            
            function trackSiteLeave() {
                localStorage.setItem('lastVisit', Date.now().toString());
            }
            
            window.addEventListener('beforeunload', trackSiteLeave);
            window.addEventListener('pagehide', trackSiteLeave);
            
            function showWelcomeBackOverlay() {
                const overlay = document.getElementById('welcomeBackOverlay');
                const title = document.getElementById('welcomeBackTitle');
                const message = document.getElementById('welcomeBackMessage');
                const userName = localStorage.getItem('userName');
                
                title.textContent = `Welcome Back, ${userName}!`;
                message.textContent = 'Great to see you again!';
                
                overlay.classList.add('show');
                
                setTimeout(() => {
                    overlay.classList.remove('show');
                }, 3000);
            }
            
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(checkWelcomeBack, 100);
            });
        </script>
        		<script src="js/settings.js" defer></script>
		<script src="js/main.js" defer></script>
		<script src="js/transitions.js" defer></script>	
	</body>
</html>
