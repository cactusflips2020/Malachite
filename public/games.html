<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title is="chemical-title" data-title-store>Malachite</title>
		<link rel="icon" is="chemical-icon" data-icon-store href="img/favicon.svg">
				<link rel="stylesheet" href="css/index.css">
		<link rel="stylesheet" href="css/transitions.css">
		<link rel="stylesheet" href="css/games.css">
		<link rel="stylesheet" href="css/modals.css">
		<script src="/chemical.js"></script>
		<script src="/chemical.components.js"></script>
		<script src="/chemical.cloaking.js"></script>
		<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
	</head>
	<body class="games-page">
		<div id="particles-js"></div>
		<div class="navbar">
			<div class="logo-container">
				<a href="index.html">
				<svg class="svg-logo" xmlns="http://www.w3.org/2000/svg" width="100" height="85" viewBox="0 0 300 255" preserveAspectRatio="xMidYMid meet">
					<g transform="translate(0,255) scale(0.1,-0.1)" fill="currentColor" stroke="none">
						<path d="M391 1923 c-200 -344 -365 -633 -367 -642 -2 -9 161 -299 364 -646 l367 -630 747 -3 746 -2 363 622 c199 343 366 630 372 638 6 11 -85 177 -361 650 l-370 635 -749 2 -748 2 -364 -626z m2008 -130 c162 -278 294 -511 294 -517 0 -6 -132 -240 -294 -518 l-294 -507 -601 -1 -600 0 -297 509 c-163 281 -297 513 -297 517 0 3 133 235 296 515 l297 509 601 0 601 0 294 -507z"/>
					</g>
				</svg>
				</a>
				<a href="index.html">Malachite</a>
			</div>
			<div class="nav-links">
				<a href="games.html">
					<i class="fa-solid fa-gamepad"></i> Games
				</a>
				<a href="apps.html">
					<i class="fa-solid fa-border-all"></i> Apps
				</a>
				<a href="settings.html">
					<i class="fa-solid fa-gear"></i> Settings
				</a>
			</div>
		</div>	
		<input type="text" id="search-input" placeholder="Search games..." />
		<div class="games-container" id="games-container"></div>
			
			<!-- Add Custom Game Modal -->
			<div id="add-game-modal" class="add-modal">
				<div id="add-game-particles-js"></div>
				<div class="add-modal-content">
					<div class="add-modal-header">
						<h2>Add Custom Game</h2>
						<button class="close-modal" onclick="closeAddGameModal()">&times;</button>
					</div>
					<div class="add-modal-body">
						<div class="form-group">
							<label for="game-name">Game Name:</label>
							<input type="text" id="game-name" placeholder="Enter game name" />
						</div>
						<div class="form-group">
							<label for="game-link">Game URL:</label>
							<input type="url" id="game-link" placeholder="https://example.com" />
						</div>
						<div class="form-group">
							<label for="game-image">Image URL:</label>
							<input type="url" id="game-image" placeholder="https://example.com/image.png" />
						</div>
						<div class="form-actions">
							<button onclick="addCustomGame()" class="add-btn">Add Game</button>
							<button onclick="closeAddGameModal()" class="cancel-btn">Cancel</button>
						</div>
					</div>
				</div>
			</div>
			
			<!-- Welcome Back Overlay -->
			<div id="welcomeBackOverlay" class="welcome-back-overlay">
				<div class="welcome-back-content">
					<div class="welcome-back-icon">
						<i class="fa-solid fa-hand-wave"></i>
					</div>
					<div class="welcome-back-title" id="welcomeBackTitle">Welcome Back!</div>
					<div class="welcome-back-message" id="welcomeBackMessage">Great to see you again!</div>
				</div>
			</div>
			
		<script src="js/particles.min.js"></script>
		<script src="js/particle-configs.js"></script>
		<script src="/js/games.js" defer></script>
		<script src="js/main.js"></script>
		<script src="js/transitions.js" defer></script>	
		<script>
			// Function to initialize particles with current theme
			function initializeParticles() {
				const config = getParticleConfig();
				
				if (typeof particlesJS !== 'undefined' && config) {
					particlesJS('particles-js', config);
				}
			}

			// Initialize particles on page load
			window.addEventListener('load', initializeParticles);

			// Reinitialize particles when theme changes
			window.addEventListener('storage', function(e) {
				if (e.key === 'siteTheme') {
					// Clean up existing particles
					if (typeof pJSDom !== 'undefined' && pJSDom.length > 0) {
						pJSDom[0].pJS.fn.vendors.destroypJS();
						pJSDom = [];
					}
					// Reinitialize with new theme
					setTimeout(initializeParticles, 100);
				}
			});
			
			// Welcome back overlay functionality
			function checkWelcomeBack() {
				const lastVisit = localStorage.getItem('lastVisit');
				const currentTime = Date.now();
				const userName = localStorage.getItem('userName');
				
				// Show welcome back if:
				// 1. User has a name set
				// 2. Last visit was more than 30 seconds ago (to avoid showing on refresh)
				// 3. Last visit exists (not first time)
				// 4. User actually left the site (not just navigated between pages)
				if (userName && lastVisit && (currentTime - parseInt(lastVisit)) > 30000) {
					showWelcomeBackOverlay();
				}
				
				// Don't update last visit time here - only update when actually leaving the site
			}
			
			// Track when user leaves the site
			function trackSiteLeave() {
				localStorage.setItem('lastVisit', Date.now().toString());
			}
			
			// Listen for when user leaves the site
			window.addEventListener('beforeunload', trackSiteLeave);
			window.addEventListener('pagehide', trackSiteLeave);
			
			// Function to show welcome back overlay
			function showWelcomeBackOverlay() {
				const overlay = document.getElementById('welcomeBackOverlay');
				const title = document.getElementById('welcomeBackTitle');
				const message = document.getElementById('welcomeBackMessage');
				const userName = localStorage.getItem('userName');
				
				// Update the welcome message with user's name
				title.textContent = `Welcome Back, ${userName}!`;
				message.textContent = 'Great to see you again!';
				
				// Show the overlay
				overlay.classList.add('show');
				
				// Hide after 3 seconds
				setTimeout(() => {
					overlay.classList.remove('show');
				}, 3000);
			}
			
			// Check welcome back when page loads
			document.addEventListener('DOMContentLoaded', () => {
				setTimeout(checkWelcomeBack, 100);
			});
		</script>
	</body>
</html>